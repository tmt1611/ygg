
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project : Yggdrasil v3.0 - The World Tree</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŒ³</text></svg>">
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <link rel="stylesheet" href="./css/components.css">
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@^18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@^18.2.0/client",
        "@google/generative-ai": "https://esm.sh/@google/generative-ai@^0.14.0",
        "d3": "https://esm.sh/d3@^7.9.0",
        "uuid": "https://esm.sh/uuid@^9.0.1"
      }
    }
    </script>
    <style>
      /* Light Theme (Default) & Core Structure Variables */
      :root {
        --app-bg: #F5F5F5;
        --app-bg-rgb: 245,245,245;
        --panel-bg: #FFFFFF;
        --panel-bg-rgb: 255,255,255;
        --panel-alt-bg: #FAFAFA;
        --panel-alt-bg-rgb: 250,250,250;
        
        --text-primary: #37474F;
        --text-secondary: #546E7A;
        --text-tertiary: #78909C;
        --text-on-dark-bg: #EAEAEA; 
        --text-on-accent: #FFFFFF;
        --text-on-bark: var(--text-primary);
        
        --primary-accent: #2E7D32; /* Vibrant Leaf Green */
        --primary-accent-rgb: 46,125,50; 
        --primary-accent-dark: #1B5E20; 
        --primary-accent-light: #66BB6A; 
        --primary-accent-hover-bg: #E8F5E9; 

        --secondary-accent: #795548; /* Earthy Brown */
        --secondary-accent-rgb: 121,85,72;
        --secondary-accent-dark: #4E342E; 
        --secondary-accent-dark-rgb: 78,52,46;
        
        --border-color: #D1D5DB;
        --border-color-strong: #B0BEC5;
        --input-border-color: #CFD8DC;
        --input-focus-border-color: var(--primary-accent);
        --input-focus-shadow: 0 0 0 2px rgba(var(--primary-accent-rgb), 0.2);

        --success-color: #28A745;
        --success-bg: #EAF6EC;
        --error-color: #DC3545;
        --error-color-rgb: 220,53,69;
        --error-bg: #FBEAEA;
        --warning-color: #FFC107; 
        --warning-bg: #FFF8E1;   
        
        --disabled-bg: #E9ECEF;
        --disabled-bg-rgb: 233, 236, 239;
        --disabled-text: #6C757D;
        --disabled-border: #CED4DA;

        --link-color: var(--primary-accent);
        --link-hover-color: var(--primary-accent-dark);

        --button-primary-bg: var(--primary-accent);
        --button-primary-text: var(--text-on-accent);
        --button-primary-hover-bg: var(--primary-accent-dark);
        --button-primary-active-bg: #07372D; 

        --button-secondary-bg: var(--panel-alt-bg);
        --button-secondary-text: var(--primary-accent);
        --button-secondary-border: var(--primary-accent-light);
        --button-secondary-hover-bg: var(--primary-accent-hover-bg);
        --button-secondary-hover-border: var(--primary-accent);
        --button-secondary-hover-text: var(--primary-accent-dark);

        --button-default-bg: #F8F9FA;
        --button-default-text: var(--text-primary);
        --button-default-border: var(--border-color);
        --button-default-hover-bg: #E9ECEF;
        
        --graph-node-stroke: var(--border-color-strong);
        --graph-node-text: var(--text-primary);
        --graph-link-stroke-ecosystem: #8B7E66; 
        --graph-link-stroke: var(--graph-link-stroke-ecosystem);
        --graph-node-selected-stroke: var(--primary-accent);
        --graph-node-highlight-stroke: var(--secondary-accent-dark);

        --focus-stellar-bg: #E8F0F8;
        --focus-connector-stroke: #3498DB;
        --focus-node-asteroid-bg: #A0A0B0;
        --focus-node-asteroid-glow: #B0B0C0;
        --focus-node-planet-bg: #6F8FAF;
        --focus-node-planet-glow: #8FA9C9;
        --focus-node-star-bg: #F39C12;
        --focus-node-star-glow: #F5B041;
        --focus-node-shield-color: #5DADE2;
        --focus-node-beacon-color: #F1C40F;
        --focus-panel-text: var(--text-primary);
        --focus-panel-bg: rgba(var(--panel-bg-rgb), 0.9);
        --focus-placeholder-bg: rgba(var(--panel-alt-bg-rgb), 0.8);
        --focus-placeholder-text: var(--text-tertiary);

        --font-family-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        --font-family-serif-display: "Georgia", "Times New Roman", serif;
        --font-size-base: 14px; /* Slightly reduced base font size for compactness */
        --line-height-base: 1.5; /* Slightly reduced line height */

        --border-radius: 3px; /* Slightly reduced border radius */
        --border-radius-lg: 6px;
        --border-radius-organic: 8px 3px 8px 3px; 
        --box-shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --box-shadow-md: 0 3px 5px -1px rgba(0, 0, 0, 0.08), 0 2px 3px -1px rgba(0, 0, 0, 0.05);
        --box-shadow-lg: 0 8px 12px -3px rgba(0,0,0,0.08), 0 3px 5px -2px rgba(0,0,0,0.04);
        --text-shadow-subtle: 1px 1px 2px rgba(0,0,0,0.1);

        --importance-minor-bg: #E8F5E9; 
        --importance-minor-text: #1B5E20; 
        --importance-minor-border: #A5D6A7; 
        --importance-common-bg: #FFF3E0; 
        --importance-common-text: #E65100; 
        --importance-common-border: #FFCC80; 
        --importance-major-bg: #E3F2FD; 
        --importance-major-text: #0D47A1; 
        --importance-major-border: #90CAF9; 

        --yggdrasil-bark-bg: #EFEBE9; /* Birch Bark */
        --yggdrasil-bark-border: #D7CCC8;
        --yggdrasil-leaf-green: #2E7D32; 
        --yggdrasil-rune-glow: var(--primary-accent-light);

        --sidebar-default-width: 280px; /* Adjusted sidebar width for better content flow */
        --sidebar-collapsed-width: 50px; /* Reduced collapsed sidebar width */
        --top-bar-height: 50px; 
      }

      /* Dark Theme (Yggdrasil by Night) */
      html[data-theme='dark'] {
        --app-bg: #101418;
        --app-bg-rgb: 16,20,24;
        --panel-bg: #1A2027;
        --panel-bg-rgb: 26,32,39;
        --panel-alt-bg: #232B34;
        --panel-alt-bg-rgb: 35,43,52;

        --text-primary: #E0E6E9;
        --text-secondary: #A0AEC0;
        --text-tertiary: #718096;
        --text-on-dark-bg: #EAEAEA;
        --text-on-bark: var(--text-on-dark-bg);
        
        --primary-accent: #38A169; /* Glowing Green */
        --primary-accent-rgb: 56,161,105;
        --primary-accent-dark: #2F855A; 
        --primary-accent-light: #68D391; 
        --primary-accent-hover-bg: rgba(56, 161, 105, 0.12);
        
        --secondary-accent: #A0AEC0; /* Moonlight Silver */
        --secondary-accent-rgb: 160, 174, 192;
        --secondary-accent-dark: #718096;
        --secondary-accent-dark-rgb: 113, 128, 150;

        --border-color: #2D3748;
        --border-color-strong: #4A5568;
        --input-border-color: #4A5568;
        
        --success-color: #66BB6A; 
        --success-bg: rgba(102, 187, 106, 0.15);   
        --error-color: #EF5350;
        --error-color-rgb: 239,83,80;
        --error-bg: rgba(239, 83, 80, 0.15);     
        --warning-color: #FFEE58; 
        --warning-bg: rgba(255, 238, 88, 0.15);    

        --disabled-bg: #333333;
        --disabled-bg-rgb: 51, 51, 51;
        --disabled-text: #6A6A6A;
        --disabled-border: #454545;

        --button-primary-text: #101418; 
        --button-secondary-text: var(--primary-accent-light);
        --button-secondary-border: var(--primary-accent);
        --button-secondary-hover-bg: #333333;
        --button-secondary-hover-border: var(--primary-accent-light);
        --button-secondary-hover-text: var(--primary-accent-light);
        
        --button-default-bg: #2C2C2C;
        --button-default-text: var(--text-primary);
        --button-default-border: var(--border-color);
        --button-default-hover-bg: #383838;

        --graph-node-stroke: var(--border-color);
        --graph-node-text: var(--text-primary);
        --graph-link-stroke-ecosystem: #A1887F;
        --graph-node-highlight-stroke: #FFCA28;

        --importance-minor-bg: rgba(102, 187, 106, 0.1); 
        --importance-minor-text: #C8E6C9; 
        --importance-minor-border: #66BB6A; 
        --importance-common-bg: rgba(160, 174, 192, 0.1); 
        --importance-common-text: #E2E8F0; 
        --importance-common-border: #A0AEC0;
        --importance-major-bg: rgba(104, 211, 145, 0.2); 
        --importance-major-text: #9AE6B4;
        --importance-major-border: #68D391;

        --yggdrasil-bark-bg: #2D3748; /* Dark Slate */
        --yggdrasil-bark-border: #4A5568;
        --yggdrasil-leaf-green: #38A169;

        /* Focus View override for Dark Theme */
        --focus-stellar-bg: #080B10; 
        --focus-connector-stroke: var(--primary-accent-light); 
        --focus-node-asteroid-bg: #718096; 
        --focus-node-asteroid-glow: #A0AEC0;
        --focus-node-planet-bg: #2D3748; 
        --focus-node-planet-glow: #4A5568;
        --focus-node-star-bg: #38A169; 
        --focus-node-star-glow: #68D391;
        --focus-node-shield-color: #03a9f4; 
        --focus-node-beacon-color: #fdd835; 
        --focus-panel-text: #E0E0E0;
        --focus-panel-bg: rgba(var(--panel-bg-rgb), 0.9); 
        --focus-placeholder-bg: rgba(var(--panel-alt-bg-rgb), 0.8);
        --focus-placeholder-text: #a0a8c0;
      }

      /* Sol Theme (Ancient Scroll) */
      html[data-theme='sol'] {
        --app-bg: #FDFBF6;
        --app-bg-rgb: 253,251,246;
        --panel-bg: #FFFFFF;
        --panel-bg-rgb: 255,255,255;
        --panel-alt-bg: #FDFDFD;
        --panel-alt-bg-rgb: 253,253,253;

        --text-primary: #5D4037; /* Dark Brown */
        --text-secondary: #795548;
        --text-tertiary: #A1887F;
        --text-on-dark-bg: var(--text-primary);
        --text-on-accent: #FFFFFF;
        --text-on-bark: var(--text-primary);
        
        --primary-accent: #BF360C; /* Burnt Orange/Red Ink */
        --primary-accent-rgb: 191,54,12;
        --primary-accent-dark: #A9310A; 
        --primary-accent-light: #FF7043; 
        --primary-accent-hover-bg: rgba(191, 54, 12, 0.08);

        --secondary-accent: #FFB74D; /* Gold/Amber */
        --secondary-accent-rgb: 255,183,77;
        --secondary-accent-dark: #FFA726;
        --secondary-accent-dark-rgb: 255,167,38;
        
        --border-color: #EAE3DC;
        --border-color-strong: #CFC5BB;
        --input-border-color: #D6CFC7;
        
        --success-color: #4CAF50;
        --success-bg: #E8F5E9;
        --error-color: #D32F2F;
        --error-color-rgb: 211,47,47;
        --error-bg: #FFEBEE;
        --warning-color: #FFA000;
        --warning-bg: #FFF3E0;

        --disabled-bg: #F5F5F5;
        --disabled-bg-rgb: 245, 245, 245;
        --disabled-text: #BDBDBD;
        --disabled-border: #E0E0E0;

        --button-primary-bg: var(--primary-accent);
        --button-primary-hover-bg: var(--primary-accent-dark);
        
        --button-secondary-text: var(--primary-accent-dark);
        --button-secondary-border: var(--primary-accent-light);
        --button-secondary-hover-bg: var(--primary-accent-hover-bg);
        --button-secondary-hover-border: var(--primary-accent);
        --button-secondary-hover-text: var(--primary-accent-dark);

        --graph-node-stroke: var(--border-color-strong);
        --graph-link-stroke-ecosystem: #A1887F; /* Sepia */
        --graph-node-highlight-stroke: var(--warning-color);
        
        --importance-minor-bg: rgba(121, 85, 72, 0.1); 
        --importance-minor-text: #4E342E;
        --importance-minor-border: #BCAAA4; 
        --importance-common-bg: rgba(255, 152, 0, 0.1);
        --importance-common-text: #E65100;
        --importance-common-border: #FFB74D;
        --importance-major-bg: rgba(191, 54, 12, 0.1); 
        --importance-major-text: #BF360C;
        --importance-major-border: #FF8A65;

        --yggdrasil-bark-bg: #F5EFE6; /* Parchment */
        --yggdrasil-bark-border: #E0D8CE;

        /* Focus View override for Sol Theme */
        --focus-stellar-bg: #F5EFE6; 
        --focus-connector-stroke: var(--primary-accent); 
        --focus-node-asteroid-bg: #BCAAA4; 
        --focus-node-asteroid-glow: #D7CCC8;
        --focus-node-planet-bg: #FFB74D; 
        --focus-node-planet-glow: #FFD54F;
        --focus-node-star-bg: #FF7043; 
        --focus-node-star-glow: #FF8A65;
        --focus-node-shield-color: #64B5F6; 
        --focus-node-beacon-color: var(--secondary-accent-dark);
        --focus-panel-text: var(--text-primary);
        --focus-panel-bg: rgba(255, 255, 255, 0.85);
        --focus-placeholder-bg: rgba(253,251,246, 0.8);
        --focus-placeholder-text: var(--text-tertiary);
      }

      /* Ocean Theme */
      html[data-theme='ocean'] {
        --app-bg: #F0F7FA;
        --app-bg-rgb: 240,247,250;
        --panel-bg: #FFFFFF;
        --panel-bg-rgb: 255,255,255;
        --panel-alt-bg: #F8FCFD;
        --panel-alt-bg-rgb: 248,252,253;

        --text-primary: #0D47A1; /* Deep Blue */
        --text-secondary: #1565C0;
        --text-tertiary: #42A5F5;
        --text-on-dark-bg: #EAEAEA;
        --text-on-accent: #FFFFFF;
        --text-on-bark: var(--text-primary);
        
        --primary-accent: #00838F; /* Teal */
        --primary-accent-rgb: 0,131,143;
        --primary-accent-dark: #006064; 
        --primary-accent-light: #4DD0E1; 
        --primary-accent-hover-bg: rgba(0, 131, 143, 0.08);

        --secondary-accent: #FFB74D; /* Sand/Sun */
        --secondary-accent-rgb: 255,183,77;
        --secondary-accent-dark: #FFA726;
        --secondary-accent-dark-rgb: 255,167,38;
        
        --border-color: #B3E5FC;
        --border-color-strong: #81D4FA;
        --input-border-color: #90CAF9;
        
        --success-color: #4CAF50;
        --success-bg: #E8F5E9;
        --error-color: #F44336;
        --error-color-rgb: 244,67,54;
        --error-bg: #FFEBEE;
        --warning-color: #FF9800; 
        --warning-bg: #FFF3E0;   
        
        --disabled-bg: #E0E0E0;
        --disabled-bg-rgb: 224,224,224;
        --disabled-text: #9E9E9E;
        --disabled-border: #BDBDBD;

        --button-primary-bg: var(--primary-accent);
        --button-primary-text: var(--text-on-accent);
        --button-primary-hover-bg: var(--primary-accent-dark);
        --button-primary-active-bg: #004D40; 

        --button-secondary-bg: var(--panel-alt-bg);
        --button-secondary-text: var(--primary-accent);
        --button-secondary-border: var(--primary-accent-light);
        --button-secondary-hover-bg: var(--primary-accent-hover-bg);
        --button-secondary-hover-border: var(--primary-accent);
        --button-secondary-hover-text: var(--primary-accent-dark);

        --graph-node-stroke: var(--border-color-strong);
        --graph-node-text: var(--text-primary);
        --graph-link-stroke-ecosystem: #1976D2; 
        --graph-node-selected-stroke: var(--primary-accent);
        --graph-node-highlight-stroke: var(--secondary-accent-dark);

        --importance-minor-bg: rgba(var(--secondary-accent-rgb), 0.15); 
        --importance-minor-text: #E65100; 
        --importance-minor-border: #FFCC80; 
        --importance-common-bg: rgba(var(--primary-accent-rgb), 0.1); 
        --importance-common-text: #006064; 
        --importance-common-border: #80DEEA; 
        --importance-major-bg: rgba(13, 71, 161, 0.1); 
        --importance-major-text: #0D47A1; 
        --importance-major-border: #90CAF9; 

        --yggdrasil-bark-bg: #E3F2FD; /* Light Blue Foam */
        --yggdrasil-bark-border: #B3E5FC;
        --yggdrasil-leaf-green: #00838F;

        /* Focus View override for Ocean Theme */
        --focus-stellar-bg: #01579B; /* Deep Ocean */
        --focus-connector-stroke: #FFD54F; /* Sunlight through water */
        --focus-node-asteroid-bg: #455A64; /* Rock */
        --focus-node-asteroid-glow: #607D8B;
        --focus-node-planet-bg: #0288D1; /* Water Planet */
        --focus-node-planet-glow: #29B6F6;
        --focus-node-star-bg: #FBC02D; /* Sun */
        --focus-node-star-glow: #FFF176;
        --focus-node-shield-color: #4DD0E1; 
        --focus-node-beacon-color: #FFD54F;
        --focus-panel-text: #E1F5FE;
        --focus-panel-bg: rgba(1, 87, 155, 0.85);
        --focus-placeholder-bg: rgba(2, 119, 189, 0.8);
        --focus-placeholder-text: #B3E5FC;
      }

      /* Nebula Theme */
      html[data-theme='nebula'] {
        --app-bg: #0d0c1d;
        --app-bg-rgb: 13,12,29;
        --panel-bg: #19162c;
        --panel-bg-rgb: 25,22,44;
        --panel-alt-bg: #252042;
        --panel-alt-bg-rgb: 37,32,66;

        --text-primary: #e0e0e0;
        --text-secondary: #a0a0c0;
        --text-tertiary: #7f7f9f;
        --text-on-dark-bg: #EAEAEA;
        --text-on-accent: #0d0c1d;
        --text-on-bark: #e0cffc;
        
        --primary-accent: #a777ff; /* Vibrant Purple */
        --primary-accent-rgb: 167,119,255;
        --primary-accent-dark: #c39fff; 
        --primary-accent-light: #d8bfff; 
        --primary-accent-hover-bg: rgba(167, 119, 255, 0.12);

        --secondary-accent: #00e5ff; /* Cyan */
        --secondary-accent-rgb: 0,229,255;
        --secondary-accent-dark: #00cfff;
        --secondary-accent-dark-rgb: 0,207,255;

        --border-color: #3a3152;
        --border-color-strong: #4f417a;
        --input-border-color: #4a4a60;
        
        --success-color: #56d364; 
        --success-bg: rgba(35, 134, 54, 0.2);   
        --error-color: #f85149;
        --error-color-rgb: 248,81,73;
        --error-bg: rgba(217, 63, 64, 0.2);     
        --warning-color: #eac54f; 
        --warning-bg: rgba(187, 128, 9, 0.2);    

        --disabled-bg: #21262d;
        --disabled-bg-rgb: 33, 38, 45;
        --disabled-text: #6e7681;
        --disabled-border: #30363d;

        --button-primary-bg: var(--primary-accent);
        --button-primary-text: var(--text-on-accent);
        --button-primary-hover-bg: var(--primary-accent-dark);
        --button-primary-active-bg: var(--primary-accent-light);

        --button-secondary-text: var(--primary-accent-light);
        --button-secondary-border: var(--primary-accent);
        --button-secondary-hover-bg: var(--primary-accent-hover-bg);
        --button-secondary-hover-border: var(--primary-accent-light);
        
        --graph-node-stroke: var(--border-color-strong);
        --graph-link-stroke-ecosystem: #8b949e; 
        --graph-node-selected-stroke: var(--primary-accent);
        --graph-node-highlight-stroke: #eac54f;

        --importance-minor-bg: rgba(86, 211, 100, 0.1); 
        --importance-minor-text: #56d364; 
        --importance-minor-border: #56d364;
        --importance-common-bg: rgba(234, 197, 79, 0.1); 
        --importance-common-text: #eac54f; 
        --importance-common-border: #eac54f;
        --importance-major-bg: rgba(88, 166, 255, 0.1); 
        --importance-major-text: #58a6ff;
        --importance-major-border: #58a6ff;

        --yggdrasil-bark-bg: #19162c; /* Deep purple */
        --yggdrasil-bark-border: #3a3152;
        --yggdrasil-leaf-green: var(--success-color);

        /* Focus View override for Nebula Theme */
        --focus-stellar-bg: #0a041a; 
        --focus-connector-stroke: #ff00ff; /* Magenta */
        --focus-node-asteroid-bg: #6e407e; 
        --focus-node-asteroid-glow: #8e5a9e;
        --focus-node-planet-bg: #a777ff; 
        --focus-node-planet-glow: #c39fff;
        --focus-node-star-bg: #00e5ff; 
        --focus-node-star-glow: #66f5ff;
        --focus-node-shield-color: var(--primary-accent); 
        --focus-node-beacon-color: #eac54f;
        --focus-panel-text: #e0cffc;
        --focus-panel-bg: rgba(30, 10, 50, 0.9);
        --focus-placeholder-bg: rgba(20, 15, 40, 0.8);
        --focus-placeholder-text: #a098c0;
      }

      /* Synthwave Theme */
      html[data-theme='synthwave'] {
        --app-bg: #0d0221;
        --app-bg-rgb: 13,2,33;
        --panel-bg: #1a0938;
        --panel-bg-rgb: 26,9,56;
        --panel-alt-bg: #240d52;
        --panel-alt-bg-rgb: 36,13,82;

        --text-primary: #f0e8ff;
        --text-secondary: #c0b8d8;
        --text-tertiary: #9088b0;
        --text-on-dark-bg: #f0e8ff;
        --text-on-accent: #0d0221;
        --text-on-bark: #f0e8ff;
        
        --primary-accent: #ff00ff; /* Magenta */
        --primary-accent-rgb: 255,0,255;
        --primary-accent-dark: #e600e6; 
        --primary-accent-light: #ff66ff; 
        --primary-accent-hover-bg: rgba(255, 0, 255, 0.15);

        --secondary-accent: #00f0ff; /* Cyan */
        --secondary-accent-rgb: 0,240,255;
        --secondary-accent-dark: #00d0e0;
        --secondary-accent-dark-rgb: 0,208,224;
        
        --border-color: #4f21a5;
        --border-color-strong: #6c35d4;
        --input-border-color: #4f21a5;
        
        --success-color: #00ff89; 
        --success-bg: rgba(0, 255, 137, 0.15);   
        --error-color: #ff3366;
        --error-color-rgb: 255,51,102;
        --error-bg: rgba(255, 51, 102, 0.15);     
        --warning-color: #ffff00; 
        --warning-bg: rgba(255, 255, 0, 0.15);    

        --disabled-bg: #240d52;
        --disabled-bg-rgb: 36,13,82;
        --disabled-text: #9088b0;
        --disabled-border: #4f21a5;

        --button-primary-bg: var(--primary-accent);
        --button-primary-text: var(--text-on-accent);
        --button-primary-hover-bg: var(--primary-accent-dark);
        --button-primary-active-bg: var(--primary-accent-light);

        --button-secondary-text: var(--secondary-accent);
        --button-secondary-border: var(--secondary-accent);
        --button-secondary-hover-bg: rgba(var(--secondary-accent-rgb), 0.15);
        --button-secondary-hover-border: var(--secondary-accent-light);
        
        --graph-node-stroke: var(--border-color-strong);
        --graph-node-text: var(--text-primary);
        --graph-link-stroke-ecosystem: #c0b8d8; 
        --graph-node-selected-stroke: var(--primary-accent);
        --graph-node-highlight-stroke: #ffff00;

        --importance-minor-bg: rgba(var(--secondary-accent-rgb), 0.1); 
        --importance-minor-text: var(--secondary-accent); 
        --importance-minor-border: var(--secondary-accent);
        --importance-common-bg: rgba(var(--primary-accent-rgb), 0.1); 
        --importance-common-text: var(--primary-accent); 
        --importance-common-border: var(--primary-accent);
        --importance-major-bg: rgba(255, 255, 0, 0.1); 
        --importance-major-text: #ffff00;
        --importance-major-border: #ffff00;

        --yggdrasil-bark-bg: #1a0938;
        --yggdrasil-bark-border: #4f21a5;
        --yggdrasil-leaf-green: var(--secondary-accent);

        /* Focus View override for Synthwave Theme */
        --focus-stellar-bg: #000000; 
        --focus-connector-stroke: var(--secondary-accent); 
        --focus-node-asteroid-bg: #4f21a5; 
        --focus-node-asteroid-glow: #6c35d4;
        --focus-node-planet-bg: var(--primary-accent); 
        --focus-node-planet-glow: var(--primary-accent-light);
        --focus-node-star-bg: #ffff00; /* Neon Yellow */
        --focus-node-star-glow: #ffff66;
        --focus-node-shield-color: var(--secondary-accent); 
        --focus-node-beacon-color: #ffff00;
        --focus-panel-text: var(--text-primary);
        --focus-panel-bg: rgba(26, 9, 56, 0.85);
        --focus-placeholder-bg: rgba(36, 13, 82, 0.8);
        --focus-placeholder-text: var(--text-secondary);
      }

      /* Global Styles */
      *, *::before, *::after { box-sizing: border-box; }
      html, body { margin: 0; padding: 0; height: 100%; }
      body {
        font-family: var(--font-family-sans);
        font-size: var(--font-size-base);
        line-height: var(--line-height-base);
        background-color: var(--app-bg);
        color: var(--text-primary);
        transition: background-color 0.3s ease, color 0.3s ease;
        overflow: hidden; 
      }
      #root { display: contents; } 

      @keyframes yggdrasilSeedPulse { 0%, 100% { fill-opacity: 0.2; transform: scale(1); } 50% { fill-opacity: 0.8; transform: scale(1.1); } }
      @keyframes yggdrasilSeedGlow { 0%, 100% { filter: drop-shadow(0 0 2px var(--primary-accent-light)); } 50% { filter: drop-shadow(0 0 8px var(--primary-accent)); } }
      .yggdrasil-seed-spinner svg { animation: yggdrasilSeedGlow 2.5s ease-in-out infinite; }
      .yggdrasil-seed-spinner .seed-pulse-outer { animation: yggdrasilSeedPulse 2.5s ease-in-out infinite 0.2s; }
      .yggdrasil-seed-spinner .seed-pulse-inner { animation: yggdrasilSeedPulse 2.5s ease-in-out infinite 0.4s; }

      h1, h2, h3, h4, h5, h6 { margin-top: 0; margin-bottom: 0.65em; font-weight: 600; color: var(--text-primary); } /* Reduced margin */
      h1 { font-family: var(--font-family-serif-display); }
      p { margin-top: 0; margin-bottom: 0.8em; } /* Reduced margin */
      a { color: var(--link-color); text-decoration: none; transition: color 0.2s; }
      a:hover { color: var(--link-hover-color); text-decoration: underline; }
      hr { border: none; border-top: 1px solid var(--border-color); margin: 0.8em 0; } /* Reduced margin */
      
      input[type="text"], input[type="search"], input[type="password"], input[type="email"], input[type="url"], input[type="tel"], textarea, select {
        width: 100%; padding: 8px 10px; border: 1px solid var(--input-border-color); border-radius: var(--border-radius); /* Reduced padding */
        background-color: var(--panel-bg); color: var(--text-primary); font-size: 0.9em; transition: border-color 0.2s ease, box-shadow 0.2s ease; /* Reduced font-size */
      }
      input:focus, textarea:focus, select:focus { outline: none; border-color: var(--input-focus-border-color); box-shadow: var(--input-focus-shadow); }
      select { appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23546E7A%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 8px center; background-size: 9px; padding-right: 25px; } /* Adjusted select arrow */
      html[data-theme='dark'] select { background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23A0AEC0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); }
      html[data-theme='nebula'] select { background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23a0a0c0%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); }
      html[data-theme='sol'] select { background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23795548%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); }
      html[data-theme='ocean'] select { background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%230D47A1%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); }
      html[data-theme='synthwave'] select { background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23c0b8d8%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'); }

      button, input[type="submit"], input[type="button"] {
        padding: 8px 12px; border: 1px solid var(--button-default-border); border-radius: var(--border-radius); /* Reduced padding */
        background-color: var(--button-default-bg); color: var(--button-default-text); font-size: 0.9em; font-weight: 500; /* Reduced font-size */
        cursor: pointer; transition: background-color 0.2s ease, border-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
        box-shadow: var(--box-shadow-sm); 
      }
      button:hover, input[type="submit"]:hover, input[type="button"]:hover { background-color: var(--button-default-hover-bg); box-shadow: var(--box-shadow-md); transform: translateY(-1px); }
      button:active { transform: translateY(0px); box-shadow: inset 0 1px 2px rgba(0,0,0,0.1); }
      button:disabled, input:disabled { cursor: not-allowed; background-color: var(--disabled-bg); color: var(--disabled-text); border-color: var(--disabled-border); opacity: 0.7; box-shadow: none; transform: none;}
      
      button.primary { 
        background-color: var(--button-primary-bg); color: var(--button-primary-text); border-color: var(--button-primary-bg); 
        background-image: linear-gradient(to bottom, rgba(255,255,255,0.08), rgba(0,0,0,0.08));
      }
      html[data-theme='dark'] button.primary,
      html[data-theme='nebula'] button.primary,
      html[data-theme='synthwave'] button.primary { background-image: linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(0,0,0,0.1)); }
      button.primary:hover { background-color: var(--button-primary-hover-bg); border-color: var(--button-primary-hover-bg); }
      button.primary:active { background-color: var(--button-primary-active-bg); }
      
      button.success { 
        background-color: var(--success-color); color: var(--text-on-accent); border-color: var(--success-color); 
        background-image: linear-gradient(to bottom, rgba(255,255,255,0.08), rgba(0,0,0,0.08));
      }
      button.success:hover { background-color: #218838; border-color: #1e7e34; }
      button.success:active { background-color: #1e7e34; }
      
      button.danger { 
        background-color: var(--error-color); color: var(--text-on-accent); border-color: var(--error-color); 
        background-image: linear-gradient(to bottom, rgba(255,255,255,0.08), rgba(0,0,0,0.08));
      }
      button.danger:hover { background-color: #b02a37; border-color: #a02531; }
      button.danger:active { background-color: #a02531; }

      button.secondary { background-color: var(--button-secondary-bg); color: var(--button-secondary-text); border: 1px solid var(--button-secondary-border); }
      button.secondary:hover { background-color: var(--button-secondary-hover-bg); border-color: var(--button-secondary-hover-border); color: var(--button-secondary-hover-text); }
      button.base-icon-button { background: none; border: none; padding: 5px; font-size: 1.1em; line-height: 1; border-radius: 50%; box-shadow: none; } /* Reduced padding */
      button.base-icon-button:hover { background-color: var(--primary-accent-hover-bg); color: var(--primary-accent); }
      button.base-icon-button:active { transform: scale(0.95); }

      /* New Yggdrasil Layout with Top Bar */
      .yggdrasil-app-outer-wrapper { display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
      .yggdrasil-app-body { display: flex; flex-grow: 1; height: calc(100vh - var(--top-bar-height)); overflow: hidden; }

      .yggdrasil-top-bar {
        height: var(--top-bar-height);
        background-color: var(--yggdrasil-bark-bg);
        color: var(--text-on-dark-bg);
        border-bottom: 2px solid var(--secondary-accent-dark);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 12px; /* Reduced padding */
        flex-shrink: 0;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        z-index: 200; 
      }
      html[data-theme='light'] .yggdrasil-top-bar { 
        background-color: #F5F0E1; 
        color: var(--text-primary); 
        border-bottom-color: #D2B48C;
      }

      .yggdrasil-top-bar-section { display: flex; align-items: center; gap: 8px; } /* Reduced gap */
      .yggdrasil-top-bar-section.left { flex-shrink: 0; }
      .yggdrasil-top-bar-section.center { flex-grow: 1; justify-content: center; gap: 4px; } /* Reduced gap */
      .yggdrasil-top-bar-section.right { flex-shrink: 0; }

      .yggdrasil-top-bar-title { 
        font-family: var(--font-family-serif-display); 
        font-size: 1.6em; /* Reduced font size */
        color: var(--primary-accent-light);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }
      html[data-theme='light'] .yggdrasil-top-bar-title { color: var(--primary-accent-dark); text-shadow: 1px 1px 1px rgba(0,0,0,0.1); }
      
      .yggdrasil-top-bar-nav-button {
        padding: 7px 10px; /* Reduced padding */
        font-size: 0.85em; /* Reduced font size */
        font-weight: 500;
        border: 1px solid transparent;
        border-radius: var(--border-radius-organic);
        color: var(--text-on-dark-bg);
        background-color: transparent;
        transition: background-color 0.2s, color 0.2s, border-color 0.2s;
      }
      html[data-theme='light'] .yggdrasil-top-bar-nav-button { color: var(--primary-accent-dark); }
      .yggdrasil-top-bar-nav-button:hover {
        background-color: rgba(var(--primary-accent-rgb), 0.15);
        border-color: var(--primary-accent-light);
        color: var(--primary-accent-light);
      }
      html[data-theme='light'] .yggdrasil-top-bar-nav-button:hover {
        background-color: var(--primary-accent-hover-bg);
        border-color: var(--primary-accent);
        color: var(--primary-accent-dark);
      }
      .yggdrasil-top-bar-nav-button.active {
        background-color: var(--primary-accent);
        color: var(--text-on-accent);
        border-color: var(--primary-accent-dark);
        font-weight: 600;
      }
      html[data-theme='dark'] .yggdrasil-top-bar-nav-button.active { color: var(--yggdrasil-bark-bg); }

      .yggdrasil-top-bar-active-project {
        font-size: 0.8em;
        color: var(--primary-accent-light);
        margin-left: 12px; /* Space from nav buttons */
        padding: 4px 8px;
        border: 1px solid rgba(var(--primary-accent-rgb), 0.3);
        border-radius: var(--border-radius);
        background-color: rgba(var(--primary-accent-rgb), 0.1);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 220px; /* Adjust as needed */
        font-style: italic;
      }
      .yggdrasil-top-bar-active-project span {
        font-style: normal;
        opacity: 0.8;
        margin-right: 4px;
      }
      html[data-theme='light'] .yggdrasil-top-bar-active-project {
        color: var(--primary-accent-dark);
        border-color: var(--primary-accent-light);
        background-color: var(--primary-accent-hover-bg);
      }


      .yggdrasil-top-bar-action-item { font-size: 0.85em; padding: 7px 10px; border-radius: var(--border-radius); }
      .yggdrasil-top-bar-action-item.api-status { padding: 3px 6px; }
      .yggdrasil-top-bar-action-item.api-status.success { background-color: var(--success-bg); color: var(--success-color); }
      .yggdrasil-top-bar-action-item.api-status.error { background-color: var(--error-bg); color: var(--error-color); }
      
      .yggdrasil-top-bar-save-button.saved,
      .yggdrasil-top-bar-download-button.saved { 
        background-color: var(--success-color) !important; 
        border-color: var(--success-color) !important; 
        color: var(--button-primary-text) !important; 
      }
      .yggdrasil-top-bar-download-button {
        margin-left: -4px; /* Slight adjustment if too close to save button */
      }


      .knowledge-branch-sidebar {
        width: var(--sidebar-default-width);
        background-color: var(--yggdrasil-bark-bg);
        border-right: 2px solid var(--secondary-accent-dark); 
        display: flex; flex-direction: column;
        transition: width 0.3s ease;
        flex-shrink: 0;
        box-shadow: 5px 0 15px rgba(0,0,0,0.2);
        z-index: 100; 
      }
      html[data-theme='light'] .knowledge-branch-sidebar { 
        background-color: #F5F0E1; 
        background-image: linear-gradient(45deg, rgba(210, 180, 140, 0.03) 25%, transparent 25%, transparent 75%, rgba(210, 180, 140, 0.03) 75%, rgba(210, 180, 140, 0.03)),
                          linear-gradient(-45deg, rgba(210, 180, 140, 0.03) 25%, transparent 25%, transparent 75%, rgba(210, 180, 140, 0.03) 75%, rgba(210, 180, 140, 0.03));
        background-size: 18px 18px; 
        color: var(--text-primary); 
        border-right-color: #D2B48C; 
      }
      html[data-theme='dark'] .knowledge-branch-sidebar { background-color: var(--yggdrasil-bark-bg); color: var(--text-on-dark-bg); }

      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar { width: var(--sidebar-collapsed-width); }
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-header-title,
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-header-subtitle,
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-header-mode-icon,
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-tab-switcher, /* Hide tab switcher when collapsed */
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .panel-content-wrapper { display: none; } /* Kept for general CollapsiblePanel */
      
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-header { padding: 8px 4px; } /* Reduced padding */
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .collapsible-panel-header { justify-content: center; padding-left: 0; padding-right: 0; }
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .collapsible-panel-header .panel-toggle-button { display: none; }
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-header .sidebar-toggle-main { margin: 0 auto; font-size: 1.4em; } /* Slightly larger icon */
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-tools-area { display: none; }


      .sidebar-header { padding: 12px; text-align: center; border-bottom: 1px solid rgba(var(--primary-accent-rgb), 0.3); display:flex; flex-direction:column; align-items:center; } /* Reduced padding */
      .sidebar-header .sidebar-toggle-main { font-size: 1.2em; padding: 6px; margin-bottom: 4px; } /* Reduced padding/margin */
      /* Sidebar title and subtitle removed from header */
      
      .sidebar-tab-switcher {
        display: flex;
        justify-content: space-around;
        padding: 6px 4px; /* Reduced padding */
        border-bottom: 1px solid rgba(var(--primary-accent-rgb), 0.2);
        gap: 4px; /* Reduced gap */
      }
      .sidebar-tab-button {
        flex-grow: 1;
        padding: 6px 4px; /* Reduced padding */
        font-size: 0.85em; /* Reduced font size */
        border: 1px solid transparent;
        border-radius: var(--border-radius);
        background-color: transparent;
        color: var(--text-on-dark-bg);
        transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2px; /* Reduced gap for icon and label */
      }
      html[data-theme='light'] .sidebar-tab-button { color: var(--primary-accent-dark); }
      .sidebar-tab-button:hover {
        background-color: rgba(var(--primary-accent-rgb), 0.1);
        border-color: rgba(var(--primary-accent-rgb), 0.3);
      }
      html[data-theme='light'] .sidebar-tab-button:hover {
        background-color: var(--primary-accent-hover-bg);
        border-color: var(--primary-accent-light);
      }
      .sidebar-tab-button.active {
        background-color: var(--primary-accent);
        color: var(--text-on-accent);
        font-weight: 600;
      }
      html[data-theme='dark'] .sidebar-tab-button.active { color: var(--yggdrasil-bark-bg); }
      .sidebar-tab-icon { font-size: 1.3em; } /* Adjust icon size */
      .sidebar-tab-label { font-size: 0.75em; display: block; margin-top: 1px; } /* Smaller label */


      .sidebar-tools-area { flex-grow: 1; padding: 10px 8px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; } /* Adjusted padding/gap */
      .sidebar-tools-area::-webkit-scrollbar { width: 6px; } 
      .sidebar-tools-area::-webkit-scrollbar-track { background: rgba(var(--panel-bg-rgb),0.05); border-radius: 3px; }
      .sidebar-tools-area::-webkit-scrollbar-thumb { background-color: var(--secondary-accent-dark); border-radius: 3px; border: 1px solid transparent; background-clip: content-box;}
      .sidebar-tools-area::-webkit-scrollbar-thumb:hover { background-color: var(--secondary-accent); }
      html[data-theme='light'] .sidebar-tools-area::-webkit-scrollbar-thumb { background-color: #B0A08C; } 
      html[data-theme='light'] .sidebar-tools-area::-webkit-scrollbar-thumb:hover { background-color: #C0B09C; }
      
      /* General panel styling, if still used by CollapsiblePanel elsewhere, or for content directly in sidebar-tools-area */
      .knowledge-branch-sidebar .panel { 
        background: rgba(var(--panel-bg-rgb),0.05); 
        border: 1px solid rgba(var(--primary-accent-rgb),0.15); 
        padding: 10px; /* Further reduced padding if needed */
        border-radius: var(--border-radius);
      }
      html[data-theme='dark'] .knowledge-branch-sidebar .panel { 
        background: rgba(var(--panel-bg-rgb),0.1); 
        border-color: rgba(var(--primary-accent-rgb),0.2); 
      }
      
      /* If CollapsiblePanel is used *within* a tab, these would apply */
      .knowledge-branch-sidebar .collapsible-panel-header { 
        /* Styles for collapsible headers if they exist inside tabs */
         border-bottom: 1px solid rgba(var(--primary-accent-rgb), 0.1); 
         padding: 6px 8px; /* Reduced padding */
      }
      html[data-theme='dark'] .knowledge-branch-sidebar .collapsible-panel-header { border-bottom: 1px solid rgba(var(--primary-accent-rgb), 0.25); }

      .knowledge-branch-sidebar .collapsible-panel-header h3 { color: var(--text-on-dark-bg); font-size: 0.9em; } /* Reduced font size */
      html[data-theme='light'] .knowledge-branch-sidebar .collapsible-panel-header h3 { color: var(--primary-accent-dark); }
      
      .knowledge-branch-sidebar .panel-content-wrapper { color: var(--text-on-dark-bg); padding: 8px; } /* Reduced padding for CollapsiblePanel content */
      html[data-theme='light'] .knowledge-branch-sidebar .panel-content-wrapper { color: var(--text-secondary); }


      .sidebar-header-logo { display: none; margin: 10px auto 4px auto; } 
      .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-header-logo {
          display: block; width: 32px; height: 32px; fill: var(--primary-accent-light); 
      }
      html[data-theme='light'] .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-header-logo {
          fill: var(--primary-accent-dark);
      }


      .yggdrasil-core-canvas { 
        flex-grow: 1; position: relative; 
        background-color: var(--app-bg); 
        display: block; 
        height: 100%; 
        overflow-y: hidden; 
        transition: filter 0.3s ease-out, transform 0.3s ease-out; 
      }
      .yggdrasil-core-canvas.core-canvas-overlay-active {
        overflow-y: auto;
      }
      .yggdrasil-core-canvas.dimmed-for-overlay { filter: blur(2px) brightness(0.8); }
      
      .yggdrasil-core-canvas .graph-view-svg-container {
        position: fixed; 
        top: var(--top-bar-height); 
        height: calc(100vh - var(--top-bar-height)); 
        z-index: 1; 
        pointer-events: none; 
      }
      .yggdrasil-app-body:not(.sidebar-collapsed) .graph-view-svg-container {
        left: var(--sidebar-default-width);
        width: calc(100vw - var(--sidebar-default-width));
      }
      .yggdrasil-app-body.sidebar-collapsed .graph-view-svg-container {
        left: var(--sidebar-collapsed-width);
        width: calc(100vw - var(--sidebar-collapsed-width));
      }

      .graph-view-svg-container svg {
        display: block; width: 100%; height: 100%;
        pointer-events: auto;
      }

      .overlay-panel-view {
        position: relative; 
        margin: 15px auto; /* Reduced margin */
        width: clamp(320px, 85%, 1200px); /* INCREASED clamp values for more horizontal space */
        max-height: calc(100vh - var(--top-bar-height) - 30px); 
        min-height: 280px; 
        background-color: var(--panel-bg);
        border: 1px solid var(--border-color-strong);
        border-radius: var(--border-radius-lg); 
        box-shadow: var(--box-shadow-lg);
        display: flex; flex-direction: column;
        z-index: 2; 
        pointer-events: auto; 
      }
      .overlay-panel-header {
        display: flex; justify-content: space-between; align-items: center;
        padding: 10px 15px; border-bottom: 1px solid var(--border-color); /* Reduced padding */
        background-color: var(--panel-alt-bg);
        border-top-left-radius: var(--border-radius-lg);
        border-top-right-radius: var(--border-radius-lg);
      }
      .overlay-panel-header h3 { margin: 0; font-size: 1.15em; color: var(--primary-accent); } /* Reduced font size */
      .overlay-panel-content { flex-grow: 1; padding: 15px; overflow-y: auto; } /* Reduced padding */

      @keyframes runeAwakening { 0% { opacity: 0.7; transform: scale(0.95) translateY(5px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
      .whispering-runes-panel {
        position: fixed;
        bottom: 15px; 
        right: 15px;
        background-color: rgba(var(--panel-bg-rgb), 0.85);
        backdrop-filter: blur(5px);
        border: 1px solid var(--primary-accent);
        border-radius: var(--border-radius-organic);
        box-shadow: var(--box-shadow-md);
        padding: 8px; /* Reduced padding */
        display: flex;
        flex-direction: column;
        gap: 6px; /* Reduced gap */
        z-index: 70; 
        transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      }
      .whispering-runes-panel.active { animation: runeAwakening 0.4s ease-out forwards; }
      .whispering-runes-panel.hidden { transform: translateY(100px); opacity: 0; pointer-events: none; }
      .whispering-runes-panel button { width: 100%; text-align: left; background-color: transparent; border-color: transparent; color: var(--primary-accent); display: flex; align-items: center; gap: 6px; padding: 7px 8px; font-size:0.9em; } /* Reduced padding/gap/font-size */
      .whispering-runes-panel button:hover { background-color: var(--primary-accent-hover-bg); border-color: var(--primary-accent-light); }
      .whispering-runes-panel .rune-icon { font-size: 1.1em; transition: transform 0.2s ease; } /* Reduced size */
      .whispering-runes-panel button:hover .rune-icon { transform: scale(1.25); color: var(--primary-accent-dark); filter: drop-shadow(0 0 3px var(--primary-accent)); }
      .whispering-runes-panel .action-feedback .rune-icon { transform: scale(1.3) rotate(15deg); color: var(--primary-accent-dark); }
      .whispering-runes-panel .no-node-message { padding: 8px; text-align: center; font-style: italic; color: var(--text-tertiary); font-size: 0.85em; } /* Reduced padding/font-size */

      
      .panel { background-color: var(--panel-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-lg); padding: 15px; box-shadow: var(--box-shadow-sm); } /* Default panel padding reduced */
      .collapsible-panel-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; cursor: pointer; border-bottom: 1px solid transparent; transition: background-color 0.2s; } /* Reduced padding */
      .collapsible-panel-header:hover { background-color: rgba(var(--primary-accent-rgb), 0.05); }
      .collapsible-panel-header h3 { font-size: 1em; margin: 0; flex-grow: 1; } /* Reduced font size */
      .panel-header { font-size: 1.1em; font-weight: 600; color: var(--text-primary); margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; } /* Reduced font size/margin */
      .panel-sub-header { font-size: 0.95em; font-weight: 600; color: var(--text-secondary); margin-top: 12px; margin-bottom: 8px; border-bottom: 1px solid var(--border-color); padding-bottom: 4px; } /* Reduced font size/margins/padding */
      .panel-button-group { display: flex; flex-direction: column; gap: 8px; } /* Reduced gap */
      .panel-button-group .panel-button, .panel-button-group div > .panel-button { width: 100%; }
      .panel-header-icon {
        font-size: 1.1em; margin-right: 8px; color: var(--primary-accent); /* Reduced size/margin */
        filter: drop-shadow(0 0 2px rgba(var(--primary-accent-rgb), 0.3));
      }
      html[data-theme='light'] .panel-header-icon { color: var(--primary-accent-dark); filter: none; }
      .panel-header-actions { display: flex; align-items: center; gap: 4px; margin-left: auto; } /* Reduced gap */
      .panel-header-actions .base-icon-button { font-size: 0.9em; padding: 3px; } /* Reduced size/padding */
      
      .status-label { padding: 2px 6px; border-radius: var(--border-radius); font-size: 0.8em; font-weight: 500; } /* Reduced padding/font-size */
      .status-small { background-color: var(--status-small-bg); color: var(--status-small-text); border: 1px solid var(--status-small-border); }
      .status-medium { background-color: var(--status-medium-bg); color: var(--status-medium-text); border: 1px solid var(--status-medium-border); }
      .status-large { background-color: var(--status-large-bg); color: var(--status-large-text); border: 1px solid var(--status-large-border); }
      
      .status-rune { font-size: 0.9em; margin-right: 4px; } 
      .list-view-status-select, .focus-view-detail-panel .status-select, .graph-view-selected-node-panel .status-select, .overlay-panel-view .status-select {
        padding: 6px 8px; text-align: left; font-size: 0.9em; /* Reduced padding/font-size */
      }

      .tooltip-container { position: relative; display: inline-block; }
      .tooltip-text { visibility: hidden; width: max-content; max-width: 180px; background-color: var(--text-primary); color: var(--panel-bg); text-align: center; border-radius: var(--border-radius); padding: 4px 7px; position: absolute; z-index: 1050; opacity: 0; transition: opacity 0.2s, visibility 0.2s; font-size: 0.8em; box-shadow: var(--box-shadow-md); } /* Reduced padding/font-size */
      .tooltip-container:hover .tooltip-text, .tooltip-container:focus-within .tooltip-text { visibility: visible; opacity: 1; }
      .tooltip-text.position-right { top: 50%; left: 105%; transform: translateY(-50%); }
      .tooltip-text.position-bottom { top: 110%; left: 50%; transform: translateX(-50%); }
      .tooltip-text.position-top { bottom: 115%; left: 50%; transform: translateX(-50%); }
      .contextual-help-icon { display: inline-flex; align-items: center; justify-content: center; width: 16px; height: 16px; border-radius: 50%; background-color: var(--text-tertiary); color: var(--panel-bg); font-size: 0.7em; font-weight: bold; cursor: help; margin-left: 4px; user-select: none; } /* Reduced size/margin */
      .contextual-help-icon:hover, .contextual-help-icon:focus { background-color: var(--text-primary); }
      .contextual-help-icon .tooltip-text { white-space: normal; line-height: 1.4; padding: 6px 8px; }

      .modal-overlay-basic { position: fixed; inset: 0; background-color: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 1000; padding: 15px; backdrop-filter: blur(4px); } /* Reduced padding */
      .modal-content-basic { background-color: var(--panel-bg); padding: 20px 25px; border-radius: var(--border-radius-lg); box-shadow: var(--box-shadow-lg); max-width: 90vw; max-height: 90vh; overflow-y: auto; animation: modalFadeIn 0.3s ease-out; } /* Reduced padding */
      @keyframes modalFadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

      .error-message-wrapper { margin-top: 8px; }
      .error-message-animated { animation: errorAppear 0.3s ease-out; }
      @keyframes errorAppear { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
      .api-key-status-message { padding: 7px 10px; margin-top: 8px; border-radius: var(--border-radius); font-size: 0.85em; text-align: center; } /* Reduced padding/font-size */
      .api-key-status-message.success { background-color: var(--success-bg); color: var(--success-color); border: 1px solid var(--success-color); }
      .api-key-status-message.error { background-color: var(--error-bg); color: var(--error-color); border: 1px solid var(--error-color); }
      .api-key-status-message.info { background-color: var(--panel-alt-bg); color: var(--text-secondary); border: 1px solid var(--border-color); }
      .api-key-warning-block { border: 2px dashed var(--warning-color); background-color: var(--warning-bg); padding: 8px; border-radius: var(--border-radius); text-align: center;} /* Reduced padding */
      .api-key-warning-block p { margin: 2px 0; color: var(--text-primary); font-weight: 500; font-size: 0.9em;}

      /* Focus View Specific Styles */
      .focus-node-display { /* Styles for the button wrapper of the celestial body */
        background-color: transparent;
        border: none;
        padding: 0;
        cursor: pointer;
        outline: none; /* Relies on celestial-body focus styles */
        display: inline-flex; /* To make it wrap its content */
        align-items: center;
        justify-content: center;
        position: relative; /* For absolute positioning of internal elements if needed */
      }
      .focus-node-display:hover, .focus-node-display:focus {
        background-color: transparent !important; /* Ensure no background on hover/focus of wrapper */
        border: none !important; /* Ensure no border on hover/focus of wrapper */
        box-shadow: none !important; /* Ensure no shadow on hover/focus of wrapper */
      }
      .focus-node-display:focus-visible .celestial-body { /* Enhance focus visibility on the orb itself */
        box-shadow: 0 0 0 2px var(--app-bg), 0 0 0 4px var(--focus-node-beacon-color);
      }


      .overlay-panel-view .focus-view-container { 
        display: flex; flex-direction: column; height: 100%; 
        background-color: var(--focus-stellar-bg); color: var(--focus-panel-text); 
        border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg); 
      }
      .overlay-panel-view .focus-view-header { display: none; }
      .overlay-panel-view .focus-view-main-area { flex-grow: 1; display: flex; position: relative; padding: 12px; gap: 12px; overflow: hidden; } /* Reduced padding/gap */
      
      .overlay-panel-view .focus-view-layout { 
        flex-grow: 1; 
        position: relative; /* This is the main positioning context for parent/focus/children */
        display: flex; /* For overall centering if needed, but nodes are absolute */
        align-items: center; /* Center placeholder text if no nodes */
        justify-content: center; /* Center placeholder text if no nodes */
        overflow: hidden; /* Prevent nodes from overflowing if calculations are off */
      }
      .overlay-panel-view .focus-view-svg-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: visible; }
      .overlay-panel-view .focus-view-connector-line { stroke: var(--focus-connector-stroke); stroke-width: 2.5px; fill: none; marker-end: url(#warp-arrow); animation: warpPulse 2s linear infinite; }
      @keyframes warpPulse { 0% { stroke-dasharray: 10 200; stroke-dashoffset: 0; } 50% { stroke-dasharray: 50 160; stroke-dashoffset: -50; } 100% { stroke-dasharray: 10 200; stroke-dashoffset: -210; } }
      #warp-arrow path { fill: var(--focus-connector-stroke); }
      
      /* Removed fixed height and flex properties from focus-view-children-area. Child positioning is now fully absolute relative to focus-view-layout. */
      .overlay-panel-view .focus-view-parent-area, 
      .overlay-panel-view .focus-view-focus-node-area,
      .overlay-panel-view .focus-view-children-area { 
        /* These area divs are no longer primary layout drivers in the new absolute positioning scheme */
        /* They can be removed from FocusViewComponent.js if not needed for other semantic reasons */
        width: 100%; 
        display: flex; /* Kept for potential placeholder centering */
        justify-content: center;
        align-items: center;
      }
      .overlay-panel-view .focus-node-placeholder { padding: 10px 15px; border-radius: var(--border-radius); background: var(--focus-placeholder-bg); color: var(--focus-placeholder-text); font-style: italic; text-align: center; min-width: 100px; } /* Reduced padding/min-width */
      
      .overlay-panel-view .focus-view-detail-panel { 
        width: 300px; /* Slightly reduced width */
        flex-shrink: 0; 
        background-color: var(--focus-panel-bg); 
        border-left: 1px solid rgba(var(--focus-panel-text), 0.2); 
        padding: 12px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; /* Reduced padding/gap */
      }
      .overlay-panel-view .focus-view-detail-panel .form-group { margin-bottom: 10px; } /* Reduced margin */
      .overlay-panel-view .focus-view-detail-panel .form-group label { display: block; margin-bottom: 3px; font-weight: 500; font-size: 0.85em; color: var(--focus-panel-text); } /* Reduced font-size/margin */
      .overlay-panel-view .focus-view-detail-panel .form-group input[type="text"],
      .overlay-panel-view .focus-view-detail-panel .form-group textarea,
      .overlay-panel-view .focus-view-detail-panel .form-group select {
         background-color: rgba(0,0,0,0.2); color: var(--focus-panel-text); border-color: rgba(var(--focus-panel-text), 0.3);
      }
      .overlay-panel-view .focus-view-detail-panel .form-group input[type="text"]:focus,
      .overlay-panel-view .focus-view-detail-panel .form-group textarea:focus,
      .overlay-panel-view .focus-view-detail-panel .form-group select:focus {
         border-color: var(--focus-connector-stroke); box-shadow: 0 0 0 2px rgba(77, 208, 225, 0.3);
      }
      .overlay-panel-view .focus-view-detail-panel .panel-button-group button { 
        background-color: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: var(--focus-panel-text);
      }
      .overlay-panel-view .focus-view-detail-panel .panel-button-group button:hover { background-color: rgba(255,255,255,0.2); }
      .overlay-panel-view .focus-view-detail-panel .panel-button-group button.primary { background-color: var(--focus-connector-stroke); color: var(--focus-stellar-bg); border-color: var(--focus-connector-stroke);}
      .overlay-panel-view .focus-view-detail-panel .panel-button-group button.danger { background-color: var(--error-color); color: var(--text-on-accent); border-color: var(--error-color);}

      .graph-view-wrapper { display: flex; height: 100%; width:100%; overflow: hidden; background: var(--app-bg); } 
      html[data-theme='dark'] .graph-view-svg-container { 
        --grid-line-color: rgba(var(--primary-accent-rgb), 0.08);
        background: 
          linear-gradient(var(--grid-line-color) 1px, transparent 1px),
          linear-gradient(to right, var(--grid-line-color) 1px, transparent 1px),
          radial-gradient(ellipse at center, rgba(var(--primary-accent-rgb),0.05) 0%, rgba(var(--yggdrasil-leaf-green),0.02) 40%, transparent 75%), var(--app-bg); 
        background-size: 25px 25px, 25px 25px, auto, auto;
      }
      html[data-theme='light'] .graph-view-svg-container { 
        --grid-line-color: rgba(var(--primary-accent-rgb), 0.1);
        background: 
          linear-gradient(var(--grid-line-color) 1px, transparent 1px),
          linear-gradient(to right, var(--grid-line-color) 1px, transparent 1px),
          radial-gradient(ellipse at center, rgba(200,230,201,0.08) 0%, rgba(var(--yggdrasil-leaf-green),0.03) 40%, transparent 75%), var(--app-bg);
        background-size: 25px 25px, 25px 25px, auto, auto;
      }
      
      .graph-view-node circle {
        transition: transform 0.2s ease-out, filter 0.2s ease-out;
        filter: drop-shadow(0px 2px 3px rgba(0,0,0,0.15));
      }
      .graph-view-node:not(.proxy):hover circle {
        transform: scale(1.1);
        filter: drop-shadow(0px 3px 6px rgba(var(--primary-accent-rgb), 0.4));
      }
      .graph-view-node.selected circle { stroke: var(--graph-node-selected-stroke); stroke-width: 3px; filter: drop-shadow(0 0 8px var(--graph-node-selected-stroke)); }
      .graph-view-node text.node-label { text-shadow: 0 0 3px var(--app-bg), 0 0 3px var(--app-bg), 0 0 3px var(--app-bg); } 
      html[data-theme='dark'] .graph-view-node text.node-label { text-shadow: 0 0 3px var(--app-bg), 0 0 3px var(--app-bg), 0 0 3px var(--app-bg), 0 0 5px var(--primary-accent-light); }
      
      .graph-view-link { stroke: var(--graph-link-stroke-ecosystem); stroke-linecap: round; }
      .graph-view-project-link { stroke: var(--primary-accent); stroke-linecap: round; }
      
      .graph-view-node .node-rune-icon { font-size: 0.7em; dominant-baseline: middle; text-anchor: middle; fill: var(--text-primary); }
      .graph-view-node .node-icon { font-size: 0.6em; }

      .graph-view-node.proxy circle {
        stroke-dasharray: 3, 3;
        fill: rgba(var(--panel-bg-rgb), 0.1);
        stroke: var(--text-tertiary);
        filter: none;
      }
      .graph-view-node.proxy:hover circle {
        transform: scale(1.05);
        stroke: var(--primary-accent);
      }
      .graph-view-node.proxy .node-label {
        fill: var(--text-secondary);
        font-size: 10px;
        font-weight: 600;
        text-transform: uppercase;
      }
      .graph-view-node.proxy .node-rune-icon {
        display: none; /* Icon is replaced by internal label */
      }


      .graph-view-controls { position: absolute; top: 8px; right: 8px; display: flex; flex-direction: column; gap: 6px; z-index: 10; pointer-events: auto; } /* Reduced spacing/gap */
      .graph-view-controls button { 
        background-color: rgba(var(--panel-bg-rgb), 0.8); backdrop-filter: blur(2px); border: 1px solid var(--border-color); 
        padding: 6px; font-size: 1em; line-height: 1; /* Reduced padding/font-size */
        width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; /* Reduced size */
      }
      .graph-view-selected-node-panel { display: none; } 

      /* Removed rule for .knowledge-branch-sidebar .ai-insights-panel .panel-header */
      .ai-insights-panel { /* Styling for the content area of AI insights tab */
        display: flex; flex-direction: column; gap: 10px;
      }
      .ai-insights-section { margin-bottom: 8px; } /* Reduced margin */
      .ai-insights-section h4 { 
        font-size: 0.95em; 
        color: var(--primary-accent); 
        margin-bottom: 6px; 
        border-bottom: 1px solid rgba(var(--primary-accent-rgb),0.2); 
        padding-bottom: 4px;
      }
      html[data-theme='dark'] .ai-insights-section h4 { color: var(--primary-accent-light); }
      
      .ai-insights-panel textarea { font-size: 0.85em; padding: 6px 8px; }


      .ai-insights-list { 
        list-style: none; padding: 0; margin: 0; 
        overflow-y: visible; 
      }
      .ai-insights-list li { display: flex; justify-content: space-between; align-items: center; padding: 5px 0; border-bottom: 1px dotted var(--border-color); font-size: 0.85em;} /* Reduced padding/font-size */
      .ai-insights-list li:last-child { border-bottom: none; }
      .ai-insights-list li .add-child-btn { font-size: 0.75em; padding: 2px 5px; } /* Reduced font-size/padding */

      .placeholder-center-content { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; color: var(--text-secondary); padding: 15px; } /* Reduced padding */
      .placeholder-center-content .placeholder-icon { font-size: 3.5em; margin-bottom: 15px; color: var(--primary-accent); opacity: 0.7; } /* Reduced size/margin */
      .placeholder-center-content h2 { font-family: var(--font-family-serif-display); font-size: 1.6em; color: var(--text-primary); margin-bottom: 8px;} /* Reduced size/margin */

      .celestial-body {
        width: 90px; 
        height: 90px; 
        border-radius: 50%; display: flex; flex-direction: column;
        align-items: center; justify-content: center; text-align: center;
        color: var(--focus-panel-text); position: relative;
        box-shadow: 0 0 8px rgba(255,255,255,0.1);
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
      }
      .focus-node-display:hover .celestial-body, .focus-node-display:focus .celestial-body { transform: scale(1.1); box-shadow: 0 0 12px var(--focus-node-beacon-color); }
      .focus-node-display.focus-node-focus .celestial-body {
        transform: scale(1.15); box-shadow: 0 0 18px var(--focus-node-star-glow), 0 0 25px var(--focus-node-star-glow);
        border: 2px solid var(--focus-node-star-glow);
      }
      .celestial-body .celestial-body-name { 
        font-size: 0.8em; 
        font-weight: bold; 
        padding: 2px 5px; 
        word-break: break-word; 
        /* max-height: 3.2em; Removed to allow full name display */
        /* overflow: hidden; Removed to allow full name display */
        white-space: normal; /* Allow wrapping */
        line-height: 1.2; /* Adjusted for better multi-line readability */
        display: -webkit-box; /* For webkit ellipsis if still needed for extreme cases, but primarily for wrapping */
        -webkit-line-clamp: 4; /* Allow up to 4 lines */
        -webkit-box-orient: vertical;
        overflow-wrap: break-word; /* Ensure long words break */
        hyphens: auto; /* Allow hyphenation for better flow */
        max-height: 4.8em; /* Approx 4 lines with 1.2 line height */
        overflow-y: auto; /* Add scroll for very very long names if they exceed max-height */
      } 
      .celestial-body .celestial-body-desc { font-size: 0.65em; opacity: 0.8; padding: 0 4px; max-height: 1.5em; overflow:hidden;} 
      
      .celestial-body.status-small { 
        background: radial-gradient(circle, var(--focus-node-asteroid-bg) 60%, var(--focus-node-asteroid-glow)); 
        width: 60px; height: 60px; 
      } 
      .celestial-body.status-medium { background: radial-gradient(circle, var(--focus-node-planet-bg) 70%, var(--focus-node-planet-glow)); } /* Default size is 90px */
      .celestial-body.status-large { 
        background: radial-gradient(circle, var(--focus-node-star-bg) 50%, var(--focus-node-star-glow) 80%, transparent 100%); 
        width: 130px; height: 130px;
      } 
      .celestial-body.is-locked::after { content: ''; position: absolute; top: -4px; left: -4px; right: -4px; bottom: -4px; border-radius: 50%; border: 2px dashed var(--focus-node-shield-color); animation: rotateShield 20s linear infinite; opacity: 0.7; }
      @keyframes rotateShield { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      .celestial-body.has-link .celestial-body-link-indicator { animation: pulseBeacon 1.5s infinite alternate; }
      /* .celestial-body.has-link::before { content: 'ðŸ”—'; position: absolute; top: 4px; right: 4px; font-size: 1em; color: var(--focus-node-beacon-color); animation: pulseBeacon 1.5s infinite alternate; filter: drop-shadow(0 0 3px var(--focus-node-beacon-color)); } */
      @keyframes pulseBeacon { from { opacity: 0.6; transform: scale(1); } to { opacity: 1; transform: scale(1.2); } }
      .celestial-body-link-indicator { /* Shared style for link indicators */
        position: absolute; top: 4px; right: 4px; font-size: 1em; 
        color: var(--focus-node-beacon-color); 
        filter: drop-shadow(0 0 3px var(--focus-node-beacon-color));
      }


      .panel-content-wrapper { 
        transition: max-height 0.35s ease-in-out, opacity 0.2s ease-in-out 0.1s, padding 0.35s ease-in-out, margin 0.35s ease-in-out, border-width 0.35s ease-in-out; 
        overflow: hidden; max-height: 100vh; 
        border-top: 1px solid rgba(var(--primary-accent-rgb),0.15); 
        padding: 8px; margin-top: 4px; 
      }
      .panel-content-wrapper.collapsed { 
        max-height: 0 !important; opacity: 0; 
        padding-top: 0 !important; padding-bottom: 0 !important; 
        margin-top:0 !important; margin-bottom:0 !important; 
        border-top-width:0 !important; 
        transition-delay: opacity 0s, padding 0s, margin 0s, border-width 0s; 
      }
      .panel-toggle-button { transition: transform 0.3s ease-in-out; background: none; border: none; padding: 3px; line-height: 1; border-radius: 50%; } 
      .panel-toggle-button svg { width: 1.1em; height: 1.1em; transition: transform 0.3s ease-in-out; fill: currentColor; display: block; } 
      .panel-toggle-button.collapsed svg { transform: rotate(-90deg); }
      .panel-toggle-button:hover { background-color: var(--primary-accent-hover-bg); }

      /* LIST VIEW MINIMALIST REDESIGN */
      .list-view-item {
        /* Removed: border, margin-bottom, background-color, box-shadow, border-radius */
        padding: 4px 0; /* Minimal vertical padding */
        border-bottom: 1px solid var(--border-color); /* Separator */
        transition: background-color 0.1s;
      }
      .list-view-item:last-child {
        border-bottom: none;
      }
      .list-view-item:hover {
        background-color: rgba(var(--primary-accent-rgb), 0.03); /* Subtle hover for the whole item */
      }
      .list-view-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 8px; /* Maintain padding for the header content */
        /* Removed: border-bottom (now on .list-view-item), cursor: default (dynamic based on clickable name) */
      }
      /* .list-view-item-header.expanded still relevant if description/children push content down */
      .list-view-name-section { display: flex; align-items: center; gap: 4px; flex-grow: 1; min-width: 0; } 
      .list-view-node-name { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 0.95em;}
      .list-view-node-name.locked { font-style: italic; opacity: 0.8; }
      .list-view-node-name.clickable { cursor: pointer; }
      .list-view-node-name.clickable:hover { color: var(--primary-accent); text-decoration: underline; }
      
      .list-view-actions { display: flex; align-items: center; gap: 2px; flex-shrink: 0; } /* Reduced gap */
      .list-item-chevron-icon { padding: 2px; font-size: 0.75em; line-height: 1; } /* Reduced padding */
      .list-item-action-icon { font-size: 0.9em; padding: 3px; } /* Reduced padding & font-size */
      .list-item-action-icon.locked { color: var(--warning-color); }
      .list-item-action-icon.primary-action { color: var(--primary-accent); }
      
      .list-view-status-select-wrapper { width: auto; } /* Make width flexible */
      .list-view-status-select { font-size: 0.8em; padding: 4px 6px; text-align: left; } /* Keep existing select styles, wrapper change will make it compact */
      
      .list-view-item-content { padding: 0 8px 8px 8px; } 
      .list-view-description-area { 
        padding: 4px 6px; /* Reduced padding */
        background-color: var(--panel-alt-bg); 
        border-radius: var(--border-radius); 
        margin-top: 4px; /* Reduced margin */
      } 
      .list-view-description { font-size: 0.85em; color: var(--text-secondary); white-space: pre-wrap; word-break: break-word; } 
      .list-view-child-container { 
        list-style: none; 
        padding: 0; 
        margin-top: 0; /* Remove top margin, rely on parent li padding */
        margin-left: 8px; 
        border-left: 1px solid var(--border-color); /* Thinner border */
      } 
      mark.search-highlight { background-color: var(--warning-bg); color: var(--text-primary); font-weight: 600; padding: 1px 0; }


      .workspace-tab-container { padding: 12px; background-color: var(--app-bg); height: 100%; overflow-y: auto; } 
      .workspace-sub-nav { display: flex; margin-bottom: 12px; border-bottom: 2px solid var(--border-color); } 
      .workspace-sub-nav button {
          padding: 8px 15px; font-size: 0.95em; font-weight: 500; 
          border: none; border-bottom: 3px solid transparent;
          background: none; color: var(--text-secondary);
          cursor: pointer; margin-right: 4px; transition: color 0.2s, border-color 0.2s; 
      }
      .workspace-sub-nav button:hover { color: var(--text-primary); border-bottom-color: var(--border-color-strong); }
      .workspace-sub-nav button.active { color: var(--primary-accent); border-bottom-color: var(--primary-accent); font-weight: 600; }
      .workspace-sub-nav button:disabled { color: var(--disabled-text); cursor: not-allowed; border-bottom-color: transparent; }
      .workspace-content-area { flex-grow: 1; overflow-y: auto; }
      .workspace-content-area > div > fieldset {
          border: 1px solid var(--border-color); border-radius: var(--border-radius-lg);
          padding: 12px 18px; margin-bottom: 15px; background-color: var(--panel-bg); 
      }
      .workspace-content-area > div > fieldset legend {
          font-weight: 600; color: var(--primary-accent); padding: 0 6px; font-size: 1.05em; 
      }
      .project-list { list-style: none; padding: 0; margin: 0; }
      .project-list-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; border-bottom: 1px solid var(--border-color); transition: background-color 0.15s; } 
      .project-list-item:last-child { border-bottom: none; }
      .project-list-item:hover { background-color: var(--panel-alt-bg); }
      .project-list-item.active { background-color: var(--primary-accent-hover-bg); border-left: 3px solid var(--primary-accent); padding-left: 5px; } 
      .project-info { display: flex; flex-direction: column; flex-grow: 1; cursor: pointer; }
      .project-name { font-weight: 500; font-size: 1em; color: var(--text-primary); } 
      .project-list-item.active .project-name { color: var(--primary-accent-dark); }
      .project-last-modified { font-size: 0.75em; color: var(--text-tertiary); } 
      .project-actions { display: flex; gap: 4px; } 
      .project-actions .base-icon-button { font-size: 1em; padding: 5px; } 
      .project-actions .delete-action { color: var(--error-color); }
      .project-actions .delete-action:hover { background-color: var(--error-bg); }
      .project-list-item.example-project .project-name { font-style: italic; color: var(--text-secondary); }
      .project-list-item.example-project.active .project-name { color: var(--primary-accent); }
        
      .project-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 12px; } 
      .stat-item { background-color: var(--panel-alt-bg); padding: 10px; border-radius: var(--border-radius); border: 1px solid var(--border-color); } 
      .stat-label { display: block; font-size: 0.85em; color: var(--text-secondary); margin-bottom: 3px; } 
      .stat-value { font-size: 1.2em; font-weight: 600; color: var(--text-primary); } 
      .stat-value.locked { color: var(--warning-color); }
      .stat-value.status-small { color: var(--status-small-text); }
      .stat-value.status-medium { color: var(--status-medium-text); }
      .stat-value.status-large { color: var(--status-large-text); }


      @media (max-width: 768px) {
        .yggdrasil-top-bar { padding: 0 8px; }
        .yggdrasil-top-bar-title { font-size: 1.4em; }
        .yggdrasil-top-bar-nav-button { padding: 5px 7px; font-size: 0.75em; }
        .yggdrasil-top-bar-section.center { gap: 1px; flex-wrap: wrap; justify-content: flex-start; }
        .yggdrasil-top-bar-active-project { max-width: 120px; margin-left: 4px; padding: 3px 5px; font-size: 0.7em; }


        .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-header .sidebar-toggle-main { font-size: 1.2em; padding: 7px; }
        .yggdrasil-app-body.sidebar-collapsed .knowledge-branch-sidebar .sidebar-header-logo { margin: 8px auto; }

        .overlay-panel-view { width: calc(100% - 16px); margin: 8px auto; max-height: calc(100vh - var(--top-bar-height) - 16px); }
        .overlay-panel-view .focus-view-main-area { flex-direction: column; }
        .overlay-panel-view .focus-view-detail-panel { width: 100%; border-left: none; border-top: 1px solid rgba(var(--focus-panel-text), 0.2); max-height: 40vh; }

        .whispering-runes-panel { bottom: 8px; right: 8px; padding: 6px; width: calc(100% - 16px); max-width: 280px; }
        
        .workspace-sub-nav button { padding: 7px 10px; font-size: 0.85em; }
        .workspace-content-area > div > fieldset { padding: 10px 12px; }
        .project-stats-grid { grid-template-columns: 1fr; } 
      }
    </style>
</head>
<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
    <script type="module" src="./js/index.js"></script>
</body>
</html>
